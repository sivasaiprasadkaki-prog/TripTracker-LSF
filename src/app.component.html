@if (currentUser()) {
  <div class="font-sans flex flex-col h-screen overflow-hidden bg-slate-100 dark:bg-slate-900 text-slate-900 dark:text-slate-100">
    <header class="flex items-center justify-between p-4 bg-white/80 dark:bg-slate-800/80 backdrop-blur-sm z-20 flex-shrink-0 border-b border-slate-200 dark:border-slate-700/50">
      <div class="flex items-center gap-2 min-w-0">
        @if (selectedLedger() && !isLedgerLoading()) {
          <button (click)="goHome()" class="p-2 -ml-2 rounded-full hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors" aria-label="Back to home">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5 8.25 12l7.5-7.5" /></svg>
          </button>
        }
        <h1 class="text-xl sm:text-2xl font-bold truncate">{{ (selectedLedger() && !isLedgerLoading()) ? selectedLedger()?.name : 'Trip Tracker' }}</h1>
      </div>
      
      <div class="flex items-center space-x-1 sm:space-x-2">
        @if (selectedLedger() && !isLedgerLoading()) {
          <div class="relative reports-menu-container">
            <button (click)="toggleReportsDropdown()" class="btn btn-reports">Reports</button>
            @if(isReportsDropdownVisible()) {
              <div class="absolute right-0 mt-2 w-48 bg-white dark:bg-slate-800 rounded-md shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none py-1 origin-top-right animate-dropdown z-20">
                <button (click)="exportToExcel()" [disabled]="isExportingExcel()" class="dropdown-item">
                  @if(isExportingExcel()){ <svg class="animate-spin h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg><span>Exporting...</span> }
                  @else { <span>Export Excel</span> }
                </button>
                <button (click)="exportToPdf()" [disabled]="isExportingPdf()" class="dropdown-item">
                   @if(isExportingPdf()){ <svg class="animate-spin h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg><span>Exporting...</span> }
                   @else { <span>Export PDF</span> }
                </button>
              </div>
            }
          </div>
        }
        
        <button (click)="toggleTheme()" class="p-2 rounded-full hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors" aria-label="Change theme">
          @if (theme() === 'dark') { <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z" /></svg> }
          @else { <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.72 9.72 0 0 1 18 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 0 0 3 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 0 0 9.002-5.998Z" /></svg> }
        </button>
        
        <div class="relative profile-menu-container">
          <button (click)="toggleProfileDropdown()" class="w-9 h-9 rounded-full hover:ring-2 hover:ring-indigo-300 dark:hover:ring-indigo-400 transition-all focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-slate-100 dark:focus:ring-offset-slate-800 focus:ring-indigo-500">
            @if (userProfile()?.photoURL) { <img [src]="userProfile()?.photoURL" alt="User Profile" class="w-full h-full rounded-full object-cover"> }
            @else { <span class="w-full h-full rounded-full bg-indigo-500 flex items-center justify-center text-white font-bold text-sm">{{ (userProfile()?.name || currentUser()?.email || 'U').charAt(0).toUpperCase() }}</span> }
          </button>
          @if(isProfileDropdownVisible()) {
            <div class="absolute right-0 mt-2 w-48 bg-white dark:bg-slate-800 rounded-md shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none py-1 origin-top-right animate-dropdown z-20">
              <button (click)="openProfileModal()" class="dropdown-item">
                <span>Edit Profile</span>
              </button>
              <button (click)="logout()" class="dropdown-item dropdown-item-danger">
                <span>Logout</span>
              </button>
            </div>
          }
        </div>
      </div>
    </header>

    <main class="flex-grow overflow-y-auto">
      @if (!selectedLedger() && !isLedgerLoading()) {
        <div class="p-4 sm:p-6 lg:p-8 animate-page-in">
          <div class="mb-6"><button (click)="openLedgerModal()" class="btn btn-primary"><span>Create New Ledger</span></button></div>
          @if (ledgers().length === 0) { <p class="text-center text-slate-500 dark:text-slate-400 mt-10">No ledgers yet. Create one to get started!</p> }
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
            @for(ledger of ledgers(); track ledger.id) {
              <div (click)="selectLedger(ledger)" class="group ledger-card cursor-pointer relative bg-white dark:bg-slate-800 rounded-lg shadow-sm border border-slate-200 dark:border-slate-700/50 p-4 flex flex-col justify-between transition-all hover:shadow-xl hover:-translate-y-1 hover:border-indigo-400/50">
                <div><h3 class="font-bold text-lg truncate">{{ ledger.name }}</h3><p class="text-xs text-slate-500 dark:text-slate-400 mt-1">Created: {{ ledger.createdAt.toLocaleDateString() }}</p></div>
                <div class="flex justify-end space-x-2 mt-4 opacity-60 group-hover:opacity-100 transition-opacity duration-300">
                  <button (click)="$event.stopPropagation(); openLedgerModal(ledger)" class="p-2 rounded-full hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors text-slate-500 dark:text-slate-400 hover:text-indigo-500 dark:hover:text-indigo-400" aria-label="Edit ledger"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5"><path d="m2.695 14.762-1.262 3.155a.5.5 0 0 0 .65.65l3.155-1.262a4 4 0 0 0 1.343-.885L17.5 5.501a2.121 2.121 0 0 0-3-3L3.58 13.42a4 4 0 0 0-.885 1.343Z" /></svg></button>
                  <button (click)="$event.stopPropagation(); deleteLedger(ledger)" class="p-2 rounded-full hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors text-slate-500 dark:text-slate-400 hover:text-red-500 dark:hover:text-red-400" aria-label="Delete ledger"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5"><path fill-rule="evenodd" d="M8.75 1A2.75 2.75 0 0 0 6 3.75v.443c-.795.077-1.58.22-2.365.468a.75.75 0 1 0 .23 1.482l.149-.022.841 10.518A2.75 2.75 0 0 0 7.596 19h4.807a2.75 2.75 0 0 0 2.742-2.53l.841-10.52.149.023a.75.75 0 0 0 .23-1.482A41.03 41.03 0 0 0 14 4.193v-.443A2.75 2.75 0 0 0 11.25 1h-2.5ZM10 4c.84 0 1.673.025 2.5.075V3.75c0-.69-.56-1.25-1.25-1.25h-2.5c-.69 0-1.25.56-1.25 1.25v.325C8.327 4.025 9.16 4 10 4ZM8.58 7.72a.75.75 0 0 0-1.5.06l.3 7.5a.75.75 0 1 0 1.5-.06l-.3-7.5Zm4.34.06a.75.75 0 1 0-1.5-.06l-.3 7.5a.75.75 0 1 0 1.5.06l.3-7.5Z" clip-rule="evenodd" /></svg></button>
                </div>
              </div>
            }
          </div>
        </div>
      } @else if (isLedgerLoading()) {
        <div class="p-4 sm:p-6 lg:p-8 animate-fade-in-fast"><div class="animate-skeleton-pulse">
          <div class="grid grid-cols-1 sm:grid-cols-3 gap-6 mb-6"><div class="h-28 bg-slate-200 dark:bg-slate-700/50 rounded-xl"></div><div class="h-28 bg-slate-200 dark:bg-slate-700/50 rounded-xl"></div><div class="h-28 bg-slate-200 dark:bg-slate-700/50 rounded-xl"></div></div>
          <div class="flex items-center space-x-4 mb-6"><div class="h-12 w-36 bg-slate-200 dark:bg-slate-700/50 rounded-lg"></div><div class="h-12 w-36 bg-slate-200 dark:bg-slate-700/50 rounded-lg"></div></div>
          <div class="bg-white dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700/50 rounded-xl p-4">
            <div class="h-8 bg-slate-200 dark:bg-slate-700/50 rounded mb-4"></div>
            <div class="space-y-3"><div class="h-10 bg-slate-200 dark:bg-slate-700/50 rounded"></div><div class="h-10 bg-slate-200 dark:bg-slate-700/50 rounded"></div><div class="h-10 bg-slate-200 dark:bg-slate-700/50 rounded"></div><div class="h-10 bg-slate-200 dark:bg-slate-700/50 rounded"></div></div>
          </div>
        </div></div>
      } @else {
        <app-ledger-details [ledger]="selectedLedger()!" />
      }
    </main>
  </div>

  @if (isLedgerModalVisible()) { <div class="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 animate-modal-in" (click)="closeLedgerModal()"><div (click)="$event.stopPropagation()" class="bg-white dark:bg-slate-800 rounded-lg shadow-xl p-8 w-full max-w-md m-4"><h2 class="text-2xl font-bold mb-6">{{ modalTitle() }}</h2><form [formGroup]="createLedgerForm" (ngSubmit)="onSaveLedger()"><div><label for="ledgerName" class="sr-only">Ledger Name</label><input formControlName="name" id="ledgerName" name="name" type="text" required class="w-full px-4 py-3 rounded-lg bg-slate-100 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 placeholder-slate-500 dark:placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-teal-500"></div><div class="flex justify-end space-x-4 mt-8"><button type="button" (click)="closeLedgerModal()" class="btn btn-neutral">Cancel</button><button type="submit" [disabled]="createLedgerForm.invalid" class="btn btn-primary">{{ modalSubmitButtonText() }}</button></div></form></div></div> }
  
  @if (ledgerToDelete()) { <div class="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 animate-modal-in"><div (click)="$event.stopPropagation()" class="bg-white dark:bg-slate-800 rounded-lg shadow-xl w-full max-w-md m-4 animate-soft-shake"><div class="p-6 text-center"><div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100 dark:bg-red-500/20"><svg class="h-6 w-6 text-red-600 dark:text-red-400" stroke="currentColor" fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg></div><h3 class="text-lg leading-6 font-medium mt-4">Delete Ledger</h3><div class="mt-2 px-7 py-3"><p class="text-sm text-slate-500 dark:text-slate-400">Are you sure you want to delete this ledger? This action cannot be undone.</p></div><div class="items-center px-4 py-3 flex gap-4"><button (click)="cancelDeleteLedger()" class="btn btn-neutral w-full">Cancel</button><button (click)="confirmDeleteLedger()" class="btn btn-danger w-full">Confirm Delete</button></div></div></div></div> }

  @if (isProfileModalVisible()) { <div class="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 animate-modal-in" (click)="closeProfileModal()"><div (click)="$event.stopPropagation()" class="bg-white dark:bg-slate-800 rounded-lg shadow-xl w-full max-w-md m-4">@switch (profileModalView()) { @case ('view') { <div class="p-8 text-center"><div class="relative w-24 h-24 mx-auto mb-4">@if (userProfile()?.photoURL) {<img [src]="userProfile()?.photoURL" alt="Profile" class="w-full h-full rounded-full object-cover shadow-md">} @else {<span class="w-full h-full rounded-full bg-indigo-500 flex items-center justify-center text-white font-bold text-4xl shadow-md">{{ (userProfile()?.name || currentUser()?.email || 'U').charAt(0).toUpperCase() }}</span>}</div><h2 class="text-2xl font-bold">{{ userProfile()?.name }}</h2><p class="text-slate-500 dark:text-slate-400">{{ userProfile()?.email }}</p><div class="flex justify-center space-x-4 mt-8"><button (click)="switchToEditProfile()" class="btn btn-secondary">Edit Profile</button><button (click)="profileModalView.set('deleteConfirm')" class="btn btn-danger">Delete Account</button></div></div> } @case ('edit') { <div class="p-8"><h2 class="text-2xl font-bold mb-6">Edit Profile</h2><form [formGroup]="editProfileForm" (ngSubmit)="onUpdateProfile()"><div class="flex items-center space-x-4 mb-6"><div class="relative w-20 h-20"><img [src]="profilePhotoPreview() || userProfile()?.photoURL || 'https://i.pravatar.cc/150?u=default'" alt="Profile Preview" class="w-full h-full rounded-full object-cover"><label for="photo-upload" class="absolute bottom-0 right-0 bg-indigo-600 hover:bg-indigo-700 text-white rounded-full p-1.5 cursor-pointer shadow-md"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4"><path d="M10 3.75a.75.75 0 0 1 .75.75v1.5a.75.75 0 0 1-1.5 0v-1.5a.75.75 0 0 1 .75-.75Zm-2.25.75a.75.75 0 0 0 0 1.5h1.5a.75.75 0 0 0 0-1.5h-1.5ZM12.5 5.25a.75.75 0 0 1 .75-.75h1.5a.75.75 0 0 1 0 1.5h-1.5a.75.75 0 0 1-.75-.75ZM5 8.25a.75.75 0 0 0 0 1.5h1.5a.75.75 0 0 0 0-1.5H5ZM12.5 9a.75.75 0 0 1 .75-.75h1.5a.75.75 0 0 1 0 1.5h-1.5a.75.75 0 0 1-.75-.75ZM5 12.25a.75.75 0 0 0 0 1.5h1.5a.75.75 0 0 0 0-1.5H5ZM10 12a.75.75 0 0 1 .75-.75h1.5a.75.75 0 0 1 0 1.5h-1.5a.75.75 0 0 1-.75-.75ZM7.25 14.25a.75.75 0 0 0 0 1.5h1.5a.75.75 0 0 0 0-1.5h-1.5Zm2.024-8.22a.75.75 0 0 0-1.048-.263l-3.333 1.667a.75.75 0 0 0 0 1.334l3.333 1.666a.75.75 0 1 0 .524-1.405l-2.09-.981 2.09-.981a.75.75 0 0 0 .524-1.039Zm3.426 3.426a.75.75 0 0 0-1.06 0l-1.667 1.667a.75.75 0 1 0 1.06 1.06l1.667-1.667a.75.75 0 0 0 0-1.06Z"/></svg></label><input id="photo-upload" type="file" class="hidden" (change)="onProfilePhotoSelected($event)" accept="image/*"></div><div class="flex-grow"><label for="profileName" class="sr-only">Full Name</label><input formControlName="name" id="profileName" type="text" required class="w-full px-4 py-3 rounded-lg bg-slate-100 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 focus:outline-none focus:ring-2 focus:ring-indigo-500"></div></div>@if (errorMessage()) {<p class="mb-4 text-center text-red-500 dark:text-red-400 animate-shake">{{ errorMessage() }}</p>} <div class="flex justify-end space-x-4 mt-8"><button type="button" (click)="profileModalView.set('view')" class="btn btn-neutral">Cancel</button><button type="submit" [disabled]="editProfileForm.invalid || isLoading()" class="btn btn-primary flex items-center">@if(isLoading()) {<svg class="animate-spin -ml-1 mr-2 h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>} <span>{{ isLoading() ? 'Saving...' : 'Save' }}</span></button></div></form></div> } @case ('deleteConfirm') { <div class="p-6 text-center animate-soft-shake"><div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100 dark:bg-red-500/20"><svg class="h-6 w-6 text-red-600 dark:text-red-400" stroke="currentColor" fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg></div><h3 class="text-lg leading-6 font-medium mt-4">Delete Account</h3><p class="text-sm text-slate-500 dark:text-slate-400 mt-2">Are you sure? This will permanently delete your account and all of your data. This action cannot be undone.</p>@if (errorMessage()) {<p class="mt-4 text-center text-red-500 dark:text-red-400 animate-shake">{{ errorMessage() }}</p>} <div class="flex gap-4 mt-6"><button (click)="profileModalView.set('view')" [disabled]="isLoading()" class="btn btn-neutral w-full">Cancel</button><button (click)="onDeleteAccount()" [disabled]="isLoading()" class="btn btn-danger w-full flex items-center">@if(isLoading()) {<svg class="animate-spin -ml-1 mr-2 h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>}<span>{{ isLoading() ? 'Deleting...' : 'Confirm Delete' }}</span></button></div></div> } }</div></div> }
} @else {
  <div class="flex items-center justify-center min-h-screen font-sans p-4 bg-slate-50 dark:bg-slate-900"><div class="w-full max-w-md"><div class="bg-white dark:bg-slate-800 rounded-xl shadow-2xl p-8 transform transition-all duration-500">@switch (view()) { @case ('login') { <div class="animate-fade-in"><h2 class="text-3xl font-bold text-center">Welcome Back</h2><p class="text-center text-slate-500 dark:text-slate-400 mt-2">Sign in to continue</p><form [formGroup]="loginForm" (ngSubmit)="onLogin()" class="mt-8 space-y-6"><div><label for="login-email" class="sr-only">Email address</label><input formControlName="email" id="login-email" name="email" type="email" autocomplete="email" required class="w-full px-4 py-3 rounded-lg bg-slate-100 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 placeholder-slate-500 dark:placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Email address"></div><div class="relative"><label for="login-password" class="sr-only">Password</label><input formControlName="password" id="login-password" name="password" [type]="loginPasswordVisible() ? 'text' : 'password'" autocomplete="current-password" required class="w-full px-4 py-3 pr-10 rounded-lg bg-slate-100 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 placeholder-slate-500 dark:placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Password"><button type="button" (click)="toggleLoginPasswordVisibility()" class="absolute inset-y-0 right-0 flex items-center px-3 text-slate-500 dark:text-slate-400 hover:text-slate-700 dark:hover:text-slate-200" aria-label="Toggle password visibility">@if (loginPasswordVisible()) {<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M3.98 8.223A10.477 10.477 0 001.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.45 10.45 0 0112 4.5c4.756 0 8.773 3.162 10.065 7.498a10.523 10.523 0 01-4.293 5.774M6.228 6.228L3 3m3.228 3.228l3.65 3.65m7.894 7.894L21 21m-3.228-3.228l-3.65-3.65m0 0a3 3 0 10-4.243-4.243m4.243 4.243a3 3 0 01-4.243-4.243" /></svg>} @else {<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.432 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z" /><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg>} </button></div><div class="text-right text-sm"><button type="button" (click)="switchToForgotPassword()" class="font-medium text-indigo-500 dark:text-indigo-400 hover:text-indigo-600 dark:hover:text-indigo-300 focus:outline-none">Forgot password?</button></div><button [disabled]="isLoading()" type="submit" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-4 rounded-lg transition-colors duration-300 ease-in-out disabled:bg-indigo-400 disabled:cursor-not-allowed flex items-center justify-center">@if (isLoading()) {<svg class="animate-spin -ml-1 mr-3 h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg><span>Signing In...</span>} @else { <span>Sign In</span> } </button></form>@if (errorMessage()) {<p class="mt-4 text-center text-red-500 dark:text-red-400 animate-shake">{{ errorMessage() }}</p>} <p class="mt-6 text-center text-sm text-slate-500 dark:text-slate-400">Don't have an account? <button (click)="switchToRegister()" class="font-medium text-indigo-500 dark:text-indigo-400 hover:text-indigo-600 dark:hover:text-indigo-300">Sign up</button></p></div> } @case ('register') { <div class="animate-fade-in"><h2 class="text-3xl font-bold text-center">Create Account</h2><p class="text-center text-slate-500 dark:text-slate-400 mt-2">Get started with us today</p><form [formGroup]="registerForm" (ngSubmit)="onRegister()" class="mt-8 space-y-4"><div><label for="register-name" class="sr-only">Name</label><input formControlName="name" id="register-name" name="name" type="text" autocomplete="name" required class="w-full px-4 py-3 rounded-lg bg-slate-100 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 placeholder-slate-500 dark:placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Full Name"></div><div><label for="register-email" class="sr-only">Email address</label><input formControlName="email" id="register-email" name="email" type="email" autocomplete="email" required class="w-full px-4 py-3 rounded-lg bg-slate-100 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 placeholder-slate-500 dark:placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Email address"></div><div class="relative"><label for="register-password" class="sr-only">Password</label><input formControlName="password" id="register-password" name="password" [type]="registerPasswordVisible() ? 'text' : 'password'" required class="w-full px-4 py-3 pr-10 rounded-lg bg-slate-100 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 placeholder-slate-500 dark:placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Password (min. 6 characters)"><button type="button" (click)="toggleRegisterPasswordVisibility()" class="absolute inset-y-0 right-0 flex items-center px-3 text-slate-500 dark:text-slate-400 hover:text-slate-700 dark:hover:text-slate-200" aria-label="Toggle password visibility">@if (registerPasswordVisible()) {<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M3.98 8.223A10.477 10.477 0 001.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.45 10.45 0 0112 4.5c4.756 0 8.773 3.162 10.065 7.498a10.523 10.523 0 01-4.293 5.774M6.228 6.228L3 3m3.228 3.228l3.65 3.65m7.894 7.894L21 21m-3.228-3.228l-3.65-3.65m0 0a3 3 0 10-4.243-4.243m4.243 4.243a3 3 0 01-4.243-4.243" /></svg>} @else {<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.432 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z" /><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg>} </button></div><div class="relative"><label for="register-repeat-password" class="sr-only">Repeat Password</label><input formControlName="repeatPassword" id="register-repeat-password" name="repeat-password" [type]="registerRepeatPasswordVisible() ? 'text' : 'password'" required class="w-full px-4 py-3 pr-10 rounded-lg bg-slate-100 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 placeholder-slate-500 dark:placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Repeat Password"><button type="button" (click)="toggleRegisterRepeatPasswordVisibility()" class="absolute inset-y-0 right-0 flex items-center px-3 text-slate-500 dark:text-slate-400 hover:text-slate-700 dark:hover:text-slate-200" aria-label="Toggle password visibility">@if (registerRepeatPasswordVisible()) {<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M3.98 8.223A10.477 10.477 0 001.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.45 10.45 0 0112 4.5c4.756 0 8.773 3.162 10.065 7.498a10.523 10.523 0 01-4.293 5.774M6.228 6.228L3 3m3.228 3.228l3.65 3.65m7.894 7.894L21 21m-3.228-3.228l-3.65-3.65m0 0a3 3 0 10-4.243-4.243m4.243 4.243a3 3 0 01-4.243-4.243" /></svg>} @else {<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.432 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z" /><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg>} </button></div><button [disabled]="isLoading()" type="submit" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-4 rounded-lg transition-colors duration-300 ease-in-out disabled:bg-indigo-400 disabled:cursor-not-allowed flex items-center justify-center">@if (isLoading()) {<svg class="animate-spin -ml-1 mr-3 h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg><span>Creating Account...</span>} @else { <span>Sign Up</span> } </button></form>@if (errorMessage()) {<p class="mt-4 text-center text-red-500 dark:text-red-400 animate-shake">{{ errorMessage() }}</p>} <p class="mt-6 text-center text-sm text-slate-500 dark:text-slate-400">Already have an account? <button (click)="switchToLogin()" class="font-medium text-indigo-500 dark:text-indigo-400 hover:text-indigo-600 dark:hover:text-indigo-300">Sign in</button></p></div> } @case ('verifyEmail') { <div class="text-center animate-fade-in"><svg class="mx-auto h-16 w-16 text-indigo-500 dark:text-indigo-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M21.75 6.75v10.5a2.25 2.25 0 0 1-2.25 2.25h-15a2.25 2.25 0 0 1-2.25-2.25V6.75m21.75 0-9-5.25m9 5.25-9 5.25m0-5.25L3 6.75M3 6.75l9 5.25" /></svg><h2 class="text-3xl font-bold mt-4">Verify Your Email</h2><p class="text-slate-500 dark:text-slate-400 mt-2">We have sent a verification email to <strong class="text-indigo-500 dark:text-indigo-300">{{ emailForMessage() }}</strong>.</p><p class="text-slate-500 dark:text-slate-400 mt-1">Please check your inbox and click the link to continue.</p><button (click)="switchToLogin()" class="mt-8 w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-4 rounded-lg transition-colors duration-300 ease-in-out focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 focus:ring-offset-slate-800">Go to Login</button></div> } @case ('forgotPassword') { <div class="animate-fade-in"><h2 class="text-3xl font-bold text-center">Reset Password</h2><p class="text-center text-slate-500 dark:text-slate-400 mt-2">Enter your email to get a reset link</p><form [formGroup]="forgotPasswordForm" (ngSubmit)="onForgotPassword()" class="mt-8 space-y-6"><div><label for="reset-email" class="sr-only">Email address</label><input formControlName="email" id="reset-email" name="email" type="email" autocomplete="email" required class="w-full px-4 py-3 rounded-lg bg-slate-100 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 placeholder-slate-500 dark:placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Email address"></div><button [disabled]="isLoading()" type="submit" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-4 rounded-lg transition-colors duration-300 ease-in-out disabled:bg-indigo-400 disabled:cursor-not-allowed flex items-center justify-center">@if (isLoading()) {<svg class="animate-spin -ml-1 mr-3 h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg><span>Sending Link...</span>} @else { <span>Get Reset Link</span> } </button></form><p class="mt-6 text-center text-sm text-slate-500 dark:text-slate-400">Remember your password? <button (click)="switchToLogin()" class="font-medium text-indigo-500 dark:text-indigo-400 hover:text-indigo-600 dark:hover:text-indigo-300">Sign in</button></p></div> } @case ('resetLinkSent') { <div class="text-center animate-fade-in"><svg class="mx-auto h-16 w-16 text-indigo-500 dark:text-indigo-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M6 12 3.269 3.125A59.769 59.769 0 0 1 21.485 12 59.768 59.768 0 0 1 3.27 20.875L5.999 12Zm0 0h7.5" /></svg><h2 class="text-3xl font-bold mt-4">Check Your Inbox</h2><p class="text-slate-500 dark:text-slate-400 mt-2">We sent a password reset link to <strong class="text-indigo-500 dark:text-indigo-300">{{ emailForMessage() }}</strong>.</p><button (click)="switchToLogin()" class="mt-8 w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-4 rounded-lg transition-colors duration-300 ease-in-out focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 focus:ring-offset-slate-800">Back to Sign In</button></div> } }</div></div></div>
}